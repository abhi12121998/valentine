<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ðŸ¤ž Promise Day</title>

  <style>
    :root{
      --text:#f8f7ff;
      --gold:#fbbf24;
      --shadow: 0 30px 80px rgba(0,0,0,0.55);
      --stroke: rgba(255,255,255,0.18);
      --glass: rgba(0,0,0,0.45);
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; margin:0; }

    body{
      overflow:hidden;
      background: #070814;
      color: var(--text);
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    }

    /* ===== FULL SCREEN IMAGE (TOP ALIGNED, NO CUTS) ===== */
    .bg{
      position: fixed;
      inset: 0;
      z-index: 0;
      background: #070814;
      display: grid;
      place-items: start center; /* âœ… start from top */
    }

    /* blurred fill behind so empty sides look nice on wide screens */
    .bg::before{
      content:"";
      position:absolute;
      inset:-30px;
      background-image: url("./assets/images/promise.png");
      background-size: cover;
      background-position: top center; /* âœ… top aligned */
      filter: blur(18px) saturate(1.1);
      opacity: 0.55;
      transform: scale(1.05);
    }

    .bg img{
      position: relative;
      z-index: 1;
      width: 100%;
      height: 100%;
      object-fit: contain;        /* âœ… no cut */
      object-position: top center; /* âœ… show from top */
    }

    /* ===== Aâ€“Z RAIN ===== */
    .rain{
      position: fixed;
      inset: 0;
      pointer-events:none;
      overflow:hidden;
      z-index: 2;
    }
    .drop{
      position:absolute;
      top:-40px;
      font-weight: 900;
      font-size: 16px;
      opacity: 0;
      color: rgba(251,191,36,0.75);
      text-shadow: 0 14px 24px rgba(0,0,0,0.35);
      animation: fall linear forwards;
      will-change: transform, opacity;
    }
    @keyframes fall{
      0%   { transform: translate3d(0,0,0); opacity: 0; }
      10%  { opacity: 0.95; }
      100% { transform: translate3d(var(--dx,0px), 110vh, 0); opacity: 0.95; }
    }

    /* flying letter that "attaches" to poem */
    .attachDrop{
      position: fixed;
      font-weight: 900;
      color: rgba(251,191,36,0.92);
      text-shadow: 0 14px 24px rgba(0,0,0,0.45);
      z-index: 5;
      pointer-events: none;
      will-change: transform, opacity;
    }

    /* ===== SMALLER BOTTOM CONTAINER (POEM) ===== */
    .poemBar{
      position: fixed;
      left: 16px;
      right: 16px;
      bottom: 12px;               /* âœ… less gap from bottom */
      z-index: 4;
      border-radius: 20px;        /* âœ… slightly tighter */
      background: var(--glass);
      border: 1px solid var(--stroke);
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
      overflow: hidden;
      padding: 12px 14px 14px;    /* âœ… reduced padding */
      max-width: 980px;
      margin: 0 auto;

      /* âœ… key: keep box from covering image */
      max-height: 44vh;           /* adjust 40â€“50vh as you like */
      display: flex;
      flex-direction: column;
    }

    .poemBar::before{
      content:"";
      position:absolute;
      inset:0;
      background:
        radial-gradient(700px 420px at 25% 20%, rgba(251,191,36,0.14), transparent 62%),
        radial-gradient(700px 420px at 80% 30%, rgba(255,77,141,0.12), transparent 62%),
        linear-gradient(to bottom, rgba(0,0,0,0.25), rgba(0,0,0,0.55));
      z-index: 0;
    }

    .poemInner{
      position: relative;
      z-index: 1;
      display: flex;
      flex-direction: column;
      height: 100%;
      min-height: 0;
    }

    .poemTitle{
      text-align:center;
      font-weight: 950;
      letter-spacing: 0.02em;
      margin-bottom: 8px;
      font-size: 13px;            /* âœ… smaller */
      opacity: 0.95;
      flex: 0 0 auto;
    }

    .divider{
      margin: 8px auto 10px;      /* âœ… reduced */
      width: 170px;               /* âœ… slightly smaller */
      height: 2px;
      background: linear-gradient(90deg, transparent, rgba(251,191,36,0.95), transparent);
      flex: 0 0 auto;
    }

    .poemText{
      white-space: pre-wrap;
      text-align:center;
      font-family: ui-serif, Georgia, "Times New Roman", serif;
      font-size: 15px;            /* âœ… reduced text size */
      line-height: 1.55;          /* âœ… reduced line gap */
      color: rgba(248,247,255,0.94);
      text-shadow: 0 12px 35px rgba(0,0,0,0.25);

      /* âœ… allow scrolling instead of growing */
      overflow: auto;
      padding-right: 6px;
      flex: 1 1 auto;
      min-height: 0;
    }

    /* make bottom box adapt on small screens */
    @media (max-width: 600px){
      .poemBar{
        left: 12px; right: 12px; bottom: 10px;
        padding: 10px 12px 12px;
        max-height: 46vh;         /* still keeps image visible */
      }
      .poemTitle{ font-size: 12px; }
      .poemText{ font-size: 14px; line-height: 1.5; }
      .divider{ width: 150px; margin: 7px auto 9px; }
    }
  </style>
</head>

<body>
  <!-- Fullscreen image -->
  <div class="bg">
    <img src="./assets/images/promise.png" alt="Promise image" />
  </div>

  <!-- Letters rain -->
  <div class="rain" id="rain"></div>

  <!-- Bottom poem container -->
  <div class="poemBar" id="poemBar">
    <div class="poemInner">
      <div class="poemTitle">ðŸ¤ž Promise Day â€¢ written by love</div>
      <div class="divider"></div>
      <div class="poemText" id="poemOut"></div>
    </div>
  </div>

  <script>
    // =========================
    // Aâ€“Z RAIN (background)
    // =========================
    const rain = document.getElementById("rain");
    const letters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");

    function spawnDrop(){
      if (!rain) return;

      const el = document.createElement("div");
      el.className = "drop";
      el.textContent = letters[(Math.random()*letters.length) | 0];

      const x = Math.random() * window.innerWidth;
      const dx = (Math.random()*2 - 1) * 140;
      const size = 12 + Math.random()*18;
      const dur = 3600 + Math.random()*3200;

      el.style.left = x + "px";
      el.style.fontSize = size + "px";
      el.style.setProperty("--dx", dx + "px");
      el.style.animationDuration = dur + "ms";

      rain.appendChild(el);
      setTimeout(() => el.remove(), dur + 250);
    }

    let rainTimer = null;
    function startRain(){
      if (rainTimer) return;
      for(let i=0;i<10;i++) setTimeout(spawnDrop, i*140);
      rainTimer = setInterval(spawnDrop, 170);
    }

    // =========================
    // POEM (assembled by falling letters)
    // =========================
    const poemLines = [
      "Baby, I promise Iâ€™ll stay with you always, just as I saidâ€”I have my own ways,",
      "Ways of loving you quietly, deeply, through all our days.",
      "",
      "Iâ€™ll never let you down, not in sunshine or in rain,",
      "I promise to stand by you, through joy, through pain.",
      "",
      "I promise to help fulfill your dreams, whatever they may be,",
      "Lawn tennis, ballet, or guitarâ€”every hope you see.",
      "",
      "Baby, I promise to take care of you like nothing else,",
      "With all my heart, my soul, my loveâ€”more than even myself. ðŸ’›"
    ];

    const poemOut = document.getElementById("poemOut");

    let typing = false;
    let stopFlag = false;

    function sleep(ms){ return new Promise(r => setTimeout(r, ms)); }

    async function attachChar(targetSpan, finalChar){
      const rect = targetSpan.getBoundingClientRect();
      const startX = rect.left + rect.width/2;
      const startY = -40;

      const d = document.createElement("div");
      d.className = "attachDrop";
      d.textContent = letters[(Math.random()*letters.length) | 0];

      const computed = window.getComputedStyle(targetSpan);
      d.style.fontSize = computed.fontSize;

      d.style.left = startX + "px";
      d.style.top = startY + "px";
      d.style.opacity = "0.95";

      document.body.appendChild(d);

      const endX = rect.left;
      const endY = rect.top;

      const dur = 130 + Math.random()*110;

      d.animate([
        { transform: `translate3d(0,0,0)`, opacity: 0.0 },
        { opacity: 1.0, offset: 0.20 },
        { transform: `translate3d(${(endX - startX)}px, ${(endY - startY)}px, 0)`, opacity: 1.0 }
      ], { duration: dur, easing: "cubic-bezier(.18,.8,.22,1)", fill: "forwards" });

      await sleep(dur);

      targetSpan.textContent = finalChar;
      targetSpan.style.opacity = "1";
      d.remove();
    }

    async function writePoem(){
      if (!poemOut || typing) return;
      typing = true;
      stopFlag = false;

      poemOut.textContent = "";
      startRain();

      for (const line of poemLines){
        if (stopFlag) break;

        const lineNode = document.createElement("div");
        poemOut.appendChild(lineNode);

        if (line === ""){
          lineNode.innerHTML = "&nbsp;";
          await sleep(600);
          continue;
        }

        const spans = [];
        for (let i=0; i<line.length; i++){
          const s = document.createElement("span");
          s.textContent = " ";
          s.style.opacity = "0";
          lineNode.appendChild(s);
          spans.push(s);
        }

        await sleep(80);

        for (let i=0; i<line.length; i++){
          if (stopFlag) break;

          const ch = line[i];
          await attachChar(spans[i], ch);

          // âœ… fixed delay (was 0.001ms)
          let delay = 55 + Math.random()*35; // 55â€“90ms
          if (ch === "," || ch === "â€”") delay += 90;
          if (ch === ".") delay += 140;

          await sleep(delay);
        }

        await sleep(120);
      }

      typing = false;
    }

    writePoem();
  </script>
</body>
</html>
